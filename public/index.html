<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Open Medical Scribe</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <div class="bg-grid" aria-hidden="true"></div>
    <main class="shell">
      <section class="hero card">
        <div>
          <p class="eyebrow">Open Medical Scribe</p>
          <h1>Simple clinical capture for multilingual transcription and draft notes.</h1>
          <p class="lede">
            Choose a country, then record or upload. Swedish is supported via browser speech transcription (`sv-SE`) and backend language hints (`sv`).
          </p>
        </div>
        <div id="runtime" class="runtime">Loading runtime config...</div>
      </section>

      <section class="workspace">
        <section class="card composer">
          <div class="panel-title">
            <h2>Capture</h2>
            <p>Only three decisions: country, record, or upload.</p>
          </div>

          <form id="scribe-form">
            <label>
              Country
              <select name="country">
                <option value="SE" selected>Sweden</option>
                <option value="US">United States</option>
                <option value="GB">United Kingdom</option>
                <option value="NO">Norway</option>
                <option value="DK">Denmark</option>
                <option value="DE">Germany</option>
              </select>
            </label>

            <label>
              Note Style
              <select name="noteStyle">
                <option value="soap" selected>SOAP Note</option>
                <option value="hp">History & Physical (H&P)</option>
                <option value="progress">Progress Note</option>
                <option value="dap">DAP (Behavioral Health)</option>
                <option value="procedure">Procedure Note</option>
              </select>
            </label>

            <section class="recorder card-soft" aria-labelledby="recorder-title">
              <div class="recorder-head">
                <div>
                  <h3 id="recorder-title">Record in Browser</h3>
                  <p>Tap once to start, tap again to stop.</p>
                </div>
                <div class="recorder-indicator">
                  <span id="record-dot" class="record-dot" aria-hidden="true"></span>
                  <span id="record-state">Ready</span>
                </div>
              </div>

              <div class="recorder-controls single-row">
                <button type="button" id="record-toggle" class="record-btn">Start Recording</button>
                <span id="record-timer" class="timer" aria-live="polite">00:00</span>
              </div>

              <label class="upload-pill" for="audio-file">
                <input id="audio-file" type="file" name="audioFile" accept="audio/*" />
                <span>Or Upload Audio File</span>
              </label>

              <div id="record-help" class="recorder-help">
                Browser recording requires `MediaRecorder` support. `localhost` is a secure context.
              </div>

              <div class="speech-box">
                <div class="speech-head">
                  <span class="speech-label">Transcript</span>
                  <span id="speech-state" class="speech-state">Unavailable</span>
                </div>
                <div id="speech-transcript" class="speech-transcript">
                  Start recording or upload audio to generate a transcript.
                </div>
              </div>

              <audio id="recording-preview" class="recording-preview" controls hidden></audio>
            </section>

            <div class="actions single-action">
              <button type="submit" id="generate-btn">Create Draft Note</button>
            </div>
          </form>
        </section>

        <section class="stack">
          <section class="card">
            <div class="panel-header">
              <div class="panel-title tight">
                <h2>Draft Note</h2>
                <p>Clinician review required.</p>
              </div>
              <span id="status" class="status">Idle</span>
            </div>
            <pre id="note" class="note-output">No note yet.</pre>
            <div id="meta" class="meta"></div>
          </section>

          <section class="card">
            <div class="panel-title tight">
              <h2>Structured Sections</h2>
              <p>Parsed note segments for quick review.</p>
            </div>
            <div id="sections" class="sections"></div>
            <div id="warnings" class="warnings"></div>
          </section>

          <section class="card">
            <div class="panel-title tight">
              <h2>FHIR Export</h2>
              <p>Generated automatically after each draft.</p>
            </div>
            <pre id="fhir-output" class="note-output compact">No export generated yet.</pre>
          </section>
        </section>
      </section>
    </main>

    <script type="module" src="/app.js"></script>
  </body>
</html>

